
services:
  eureka-server: 
    build: ./eureka-server
    container_name: eureka-server
    ports:
      - "1101:1101"
    environment:
      - SERVER_PORT=1101
      - EUREKA_INSTANCE_HOSTNAME=eureka-server
    networks:
      - tn-bridge-network

  msgbroker:
    build: ./msgbroker
    container_name: msgbroker-inst1
    ports:
      - "1201:1201"
    environment:
      - SERVER_PORT=1201
      - SPRING_KAFKA_BOOTSTRAP-SERVERS=kafka:9092
    networks:
      - tn-bridge-network
  frontend-service:
    build: ./tn-frontend-service
#    container_name: frontend-service-inst1
    ports:
      - "1301-1310:1301"
    environment:
      - SERVER_PORT=1301
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:1101/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mysql://tradenet-mysql:3306/tradenet
      - SPRING_KAFKA_BOOTSTRAP-SERVERS=kafka:9092
    networks:
      - tn-bridge-network
    deploy:
      replicas: 2
    depends_on:
      - eureka-server

  hs-service:
    build: ./hs-service
    ports:
      - "1401:1401"
    environment:
      - SERVER_PORT=1401
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:1101/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mysql://tradenet-mysql:3306/tradenet
      - SPRING_KAFKA_BOOTSTRAP-SERVERS=kafka:9092
    networks:
      - tn-bridge-network
    depends_on:
      - eureka-server

  location-service:
    build: ./location-service
    ports:
      - "1501:1501"
    environment:
      - SERVER_PORT=1501
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:1101/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mysql://tradenet-mysql:3306/tradenet
      - SPRING_KAFKA_BOOTSTRAP-SERVERS=kafka:9092
    networks:
      - tn-bridge-network
    depends_on:
      - eureka-server

  company-service:
    build: ./company-service
    ports:
      - "1601:1601"
    environment:
      - SERVER_PORT=1601
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:1101/eureka/
      - SPRING_DATASOURCE_URL=jdbc:mysql://tradenet-mysql:3306/tradenet
      - SPRING_KAFKA_BOOTSTRAP-SERVER=kafka:9092
    networks:
      - tn-bridge-network
    depends_on:
      - eureka-server

  frontend-presentation:
    build: ./tn-frontend-presentation
    container_name: frontend-presentation-inst1
    ports:
      - "4401:4401"
    environment:
      - SERVER_PORT=4401
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:1101/eureka/
    networks:
      - tn-bridge-network
    depends_on:
      - eureka-server
      - frontend-service

  api-gateway:
    build: ./api-gateway
    ports:
      - "8001:8001"
    environment:
      - SERVER_PORT=8001
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:1101/eureka/
    networks:
      - tn-bridge-network
    depends_on:
      - eureka-server
      - frontend-service
      - hs-service
      - location-service

networks:
  tn-bridge-network:
    driver: bridge
    external: true

